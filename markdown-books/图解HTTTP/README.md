# 图解HTTP 笔记

## 第一章 了解Web及网络基础

不同硬件、操作系统之间的通信，所有这一切都需要一种规则，这种规则叫做协议

HTTP 协议是 TCP/IP 协议族中的一个协议

TCP/IP 分为四层：应用层、传输层、网络层和数据链路层

分层的好处是：每个层内部可以自由改动，不会影响其它层；每一层的设计也相对简单，不用考虑其它层。

【应用层】：应用层决定了向用户提供应用服务时通信的活动，有一些常见的应用层协议：HTTP、FTP、DNS

【传输层】：传输层提供网络上两台计算机之间的数据传输。有两个性质不同的协议：TCP（传输控制协议）和 UDP（用户数据报协议）

【网络层】：网络层（IP协议）用来处理网络上流动的数据包，数据包是网络传输的最小数据传输单位，该层规定了通过怎样的路径把数据包传送给对方

【数据链路层】：链路层用来处理网络的硬件部分，包括控制操作系统、硬件设备的驱动、网卡、光纤等硬件

### IP 协议

IP协议（Internet Protocol）的作用就是把各种数据包传送给对方，而要保证实时传送到，需要两个重要条件：IP地址和MAC地址。IP间的通信依赖MAC地址，使用ARP协议才可以凭借MAC地址进行通信，使用ARP协议可以根据通信方的IP地址查出对应的MAC地址。

### 确保可靠性的TCP协议

TCP协议提供可靠的字节流服务，字节流服务是指将大块数据分割成以报文段为单位的数据包进行管理，TCP能确认数据是否传达到对方，使用三次握手策略准确无误地将数据送达目标处，三次握手的工作流程如下：
```
             --SYN-->   
客户端    <--SYN/ACK--   服务器
             --ACK-->   
```
在握手过程中如果有某个阶段莫名中断，TCP协议会再次以相同的顺序重发相同的数据包

DNS服务是应用层的服务，它提供域名到IP地址之间的解析服务

URL是URI的子集


## 第二章 简单的HTTP协议

使用HTTP协议时，必定一端是客户端，另一端是服务器端

请求必定由客户端发出，服务器端回复相应

HTTP是不保存状态的协议（无状态协议），这是为了可以更快地处理大量事务。使用Cookie技术再用HTTP通信就可以管理状态了。

告知服务器意图的HTTP方法：

1.  GET：获取资源
2.  POST：传输实体主题
3.  PUT：传输文件
4.  HEAD：获得报文首部
5.  DELETE：删除文件
6.  OPTIONS：询问支持的方法
7.  TRACE：追踪路径
8.  CONNECT：要求用隧道协议连接代理

除了支持RESTful的API可使用PUT和DELETE，一般使用GET和POST方法

HTTP协议初始版本不支持持久连接，就是说每进行一次HTTP通信就要断开一次TCP连接（断开TCP连接需要四次挥手）

```
                 ---SYN-->
                 <--SYN/ACK---
                 ---ACK-->

【客户端】    --- HTTP Request -->    【服务器】
            <-- HTTP Response --

                  <--FIN---
                  ---ACK-->
                  ---FIN-->
                  <--ACK--
```

HTTP/1.1和一部分HTTP/1.0支持了持久连接，使用管线化可以并发请求

由于HTTP是无状态协议，节约了服务器的消耗。Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态



## 第三章 HTTP报文中的HTTP信息

请求端（Client）的报文称为请求报文，响应端（Server）的报文称为响应报文，HTTP报文是由多行（使用CR+LF换行）字符串文本

HTTP报文的结构：报文首部+空行（CR+LF）+报文主体

可以使用Fiddler查看原始报文内容

![Fiddler](https://ws3.sinaimg.cn/large/005BYqpgly1g1cooeomnvj31350rgqcb.jpg)

报文主体和实体主体的差异：
1. 报文是HTTP通信的基本单位，通过HTTP通信传输
2. 实体作为请求或响应的有效载荷数据被传输，器内容由实体首部和实体主体组成

压缩传输的内容编码

通过服务器压缩后发送，客户端接收并解码

![gizp](https://ws3.sinaimg.cn/large/005BYqpggy1g1coprlhdmj31350rg489.jpg)

常用的内容编码方式：gzip（GNU）、compress（UNIX）、deflate（zlib）、identity（不进行编码）

可以通过分割发送的分块传输编码，让浏览器逐步显示页面；而不是全部传输完成，解码之后再显示页面。

通过MIME和Multipart方式，发送多种数据的多部分对象集合

范围请求：Range，请求一部分的文件内容

内容协商返回最适合的内容，通过请求报文某些首部字段，服务器自动返回最适合的内容（例如语言）



## 第四章 返回结果的HTTP状态码

状态码告知从服务器端返回的请求结果

状态码由3位数字和原因短语组成，如：200 OK。第一位指定了响应类别，后两位无分类

```
分类	分类描述
1**	信息，服务器收到请求，需要请求者继续执行操作
2**	成功，操作被成功接收并处理
3**	重定向，需要进一步的操作以完成请求
4**	客户端错误，请求包含语法错误或无法完成请求
5**	服务器错误，服务器在处理请求的过程中发生了错误
```

[HTTP状态码](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status)


## 第五章 与HTTP协作的Web服务器

使用单台虚拟主机（Virtual Host）实现多个域名，域名通过DNS服务映射到IP地址，由于虚拟主机可以寄存多个不同主机名和域名的网站，因此在发送HTTP请求时，必须在Host首部指定主机名或域名的URI

### 通信数据转发程序：代理、网关、隧道

![代理](https://ws3.sinaimg.cn/large/005BYqpgly1g1cq0ksamlj30m209eac4.jpg)

代理可以做到对指定URI的访问控制；**缓存代理**通过将资源缓存到代理服务器加快客户端访问速度；**透明代理**不会对报文进行任何加工处理

![网关](https://ws3.sinaimg.cn/large/005BYqpggy1g1cq56aav6j30ku06k3zf.jpg)

网关的工作机制与代理十分相似，网关能使通信线路上的服务器提供非HTTP协议的服务，使用网关能提高通信的安全性

![隧道](https://ws3.sinaimg.cn/large/005BYqpggy1g1cq5e5c8wj30md0703zn.jpg)

隧道可按要求建立起一条与其他服务器的通信线路，使用SSL等加密进行通信，保证客户端与服务端的安全通信